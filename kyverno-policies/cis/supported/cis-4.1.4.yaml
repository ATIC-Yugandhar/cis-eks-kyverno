# kyverno-policies/cis/cis-4.1.4.yaml
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: cis-4.1.4-minimize-pod-creation-access
  annotations:
    policies.kyverno.io/title: Minimize Access to Create Pods
    policies.kyverno.io/category: CIS EKS Benchmarks
    policies.kyverno.io/severity: medium
    policies.kyverno.io/subject: Role, ClusterRole
    policies.kyverno.io/minversion: 1.6.0
    policies.kyverno.io/description: >-
      The ability to create pods in a cluster introduces security risks. Access to create pods
      should be minimized to only those users or service accounts that require it. This policy
      audits Roles and ClusterRoles granting 'create' permission on pods.
    policies.kyverno.io/benchmark: cis-eks
    policies.kyverno.io/controls: "4.1.4"
spec:
  validationFailureAction: Audit
  background: true
  rules:
    - name: minimize-pod-creation-access
      match:
        any:
        - resources:
            kinds:
              - Role
              - ClusterRole
      validate:
        message: "Minimize access to create pods (CIS 4.1.4). Avoid 'create' verb for pods."
        pattern:
          rules:
          - apiGroups: [""]
            resources: ["pods"]
            verbs:
            - "!create"