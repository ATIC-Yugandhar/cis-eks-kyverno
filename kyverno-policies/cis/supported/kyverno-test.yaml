apiVersion: cli.kyverno.io/v1alpha1
kind: Test
metadata:
  name: cis-supported-policies-test
policies:
  - cis-4.1.5.yaml
  - cis-4.2.1.yaml
  - cis-4.5.2.yaml
  - cis-3.2.2.yaml
  - cis-4.1.1.yaml
  - cis-4.1.2.yaml
  - cis-4.1.3.yaml
  - cis-4.1.4.yaml
  - cis-4.1.6.yaml
  - cis-4.1.8.yaml
  - cis-4.2.2.yaml
  - cis-4.2.3.yaml
  - cis-4.2.4.yaml
  - cis-4.2.5.yaml
  - cis-4.3.2.yaml
  - cis-4.4.1.yaml
  - cis-4.5.1.yaml
  - cis-5.1.1.yaml
  - cis-5.1.4.yaml
  - cis-5.1.6.yaml
  - cis-5.2.2.yaml
  - cis-5.2.3.yaml
  - cis-5.3.2.yaml
  - cis-5.4.4.yaml
  - cis-5.5.1.yaml
  - cis-5.5.2.yaml
resources:
  - resources-4.1.5.yaml
  - resources-4.2.1.yaml
  - resources-4.5.2.yaml
  - resources-3.2.2.yaml
  - resources-4.1.1.yaml
  - resources-4.1.2.yaml
  - resources-4.1.3.yaml
  - resources-4.1.4.yaml
  - resources-4.1.6.yaml
  - resources-4.1.8.yaml
  - resources-4.2.2.yaml
  - resources-4.2.3.yaml
  - resources-4.2.4.yaml
  - resources-4.2.5.yaml
  - resources-4.3.2.yaml
  - resources-4.4.1.yaml
  - resources-4.5.1.yaml
  - resources-5.1.1.yaml
  - resources-5.1.4.yaml
  - resources-5.1.6.yaml
  - resources-5.2.2.yaml
  - resources-5.2.3.yaml
  - resources-5.3.2.yaml
  - resources-5.4.4.yaml
  - resources-5.5.1.yaml
  - resources-5.5.2.yaml
results:
  # CIS-4.1.5 Test Results
  - policy: cis-4.1.5-disallow-default-serviceaccount
    rule: check-default-serviceaccount
    resource: pod-pass-explicit-sa
    kind: Pod
    result: pass
  - policy: cis-4.1.5-disallow-default-serviceaccount
    rule: check-default-serviceaccount
    resource: pod-pass-default-sa-no-mount
    kind: Pod
    result: pass
  - policy: cis-4.1.5-disallow-default-serviceaccount
    rule: check-default-serviceaccount
    resource: pod-pass-implicit-sa-no-mount
    kind: Pod
    result: pass
  - policy: cis-4.1.5-disallow-default-serviceaccount
    rule: check-default-serviceaccount
    resource: pod-fail-explicit-default-sa
    kind: Pod
    result: fail
  - policy: cis-4.1.5-disallow-default-serviceaccount
    rule: check-default-serviceaccount
    resource: pod-fail-implicit-default-sa
    kind: Pod
    result: fail

  # CIS-4.2.1 Test Results
  - policy: cis-4.2.1-disallow-privileged-containers
    rule: validate-no-privileged
    resource: pod-no-privileged
    kind: Pod
    result: pass
  - policy: cis-4.2.1-disallow-privileged-containers
    rule: validate-no-privileged
    resource: pod-explicit-not-privileged
    kind: Pod
    result: pass
  - policy: cis-4.2.1-disallow-privileged-containers
    rule: validate-no-privileged
    resource: pod-privileged
    kind: Pod
    result: fail
  - policy: cis-4.2.1-disallow-privileged-containers
    rule: validate-no-privileged
    resource: pod-mixed-privileged
    kind: Pod
    result: fail

  # CIS-4.5.2 Test Results
  - policy: cis-4.5.2-disallow-default-namespace
    rule: require-namespace-not-default
    resource: pod-in-named-namespace
    kind: Pod
    result: pass
  - policy: cis-4.5.2-disallow-default-namespace
    rule: require-namespace-not-default
    resource: pod-in-kube-system
    kind: Pod
    result: pass
  - policy: cis-4.5.2-disallow-default-namespace
    rule: require-namespace-not-default
    resource: pod-in-default-namespace
    kind: Pod
    result: fail
  - policy: cis-4.5.2-disallow-default-namespace
    rule: require-namespace-not-default
    resource: pod-implicit-default-namespace
    kind: Pod
    result: fail
