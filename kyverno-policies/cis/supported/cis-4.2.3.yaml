# kyverno-policies/cis/cis-4.2.3.yaml
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: cis-4.2.3-disallow-host-ipc
  annotations:
    policies.kyverno.io/title: Disallow Host IPC Namespace Sharing
    policies.kyverno.io/category: CIS EKS Benchmarks
    policies.kyverno.io/severity: medium
    policies.kyverno.io/subject: Pod
    policies.kyverno.io/minversion: 1.6.0
    policies.kyverno.io/description: >-
      Sharing the host's IPC namespace allows container processes to communicate with processes
      on the host. This should not be allowed. This policy validates that Pods do not set
      spec.hostIPC to true.
    policies.kyverno.io/benchmark: cis-eks
    policies.kyverno.io/controls: "4.2.3"
spec:
  validationFailureAction: Audit
  background: true
  rules:
    - name: disallow-host-ipc
      match:
        any:
        - resources:
            kinds:
              - Pod
      validate:
        message: "Sharing the host IPC namespace is disallowed (CIS 4.2.3)."
        pattern:
          spec:
            =(hostIPC): false # Checks if hostIPC is explicitly false or absent (defaults to false)