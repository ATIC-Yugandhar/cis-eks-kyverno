# kyverno-policies/cis/cis-4.2.2.yaml
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: cis-4.2.2-disallow-host-pid
  annotations:
    policies.kyverno.io/title: Disallow Host PID Namespace Sharing
    policies.kyverno.io/category: CIS EKS Benchmarks
    policies.kyverno.io/severity: medium
    policies.kyverno.io/subject: Pod
    policies.kyverno.io/minversion: 1.6.0
    policies.kyverno.io/description: >-
      Sharing the host's process namespace allows processes within the container to see all
      processes on the host system. This should not be allowed. This policy validates
      that Pods do not set spec.hostPID to true.
    policies.kyverno.io/benchmark: cis-eks
    policies.kyverno.io/controls: "4.2.2"
spec:
  validationFailureAction: Audit
  background: true
  rules:
    - name: disallow-host-pid
      match:
        any:
        - resources:
            kinds:
              - Pod
      validate:
        message: "Sharing the host PID namespace is disallowed (CIS 4.2.2)."
        pattern:
          spec:
            =(hostPID): false # Checks if hostPID is explicitly false or absent (defaults to false)