name: cis-4.1.8-custom-limit-bind-impersonate-test
policies:
  - cis-4.1.8-custom.yaml
resources:
  - kind: Role
    apiVersion: rbac.authorization.k8s.io/v1
    metadata:
      name: role-no-bind-impersonate
      namespace: default
    rules:
    - apiGroups: [""]
      resources: ["pods"]
      verbs: ["get", "list", "watch"]
  - kind: Role
    apiVersion: rbac.authorization.k8s.io/v1
    metadata:
      name: role-with-bind
      namespace: default
    rules:
    - apiGroups: ["rbac.authorization.k8s.io"]
      resources: ["rolebindings"]
      verbs: ["bind", "create"] # Contains 'bind'
  - kind: ClusterRole
    apiVersion: rbac.authorization.k8s.io/v1
    metadata:
      name: clusterrole-with-impersonate
    rules:
    - apiGroups: [""]
      resources: ["users", "groups", "serviceaccounts"]
      verbs: ["impersonate"] # Contains 'impersonate'
    - apiGroups: [""]
      resources: ["pods"]
      verbs: ["get"]
results:
  - policy: cis-4.1.8-custom-limit-bind-impersonate
    rule: audit-bind-impersonate-verbs
    resource: role-no-bind-impersonate
    namespace: default
    kind: Role
    result: pass # Should pass as no 'bind' or 'impersonate'
  - policy: cis-4.1.8-custom-limit-bind-impersonate
    rule: audit-bind-impersonate-verbs
    resource: role-with-bind
    namespace: default
    kind: Role
    result: fail # Should fail due to 'bind' verb
  - policy: cis-4.1.8-custom-limit-bind-impersonate
    rule: audit-bind-impersonate-verbs
    resource: clusterrole-with-impersonate
    kind: ClusterRole
    result: fail # Should fail due to 'impersonate' verb